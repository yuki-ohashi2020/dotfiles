set dotenv-load
set fallback := true

# chezmoiにパスが通ってなければエラーで終了する
SOURCE_DIR := `chezmoi source-path`
BIN_DIR    := SOURCE_DIR + "/bin"
# スクリプトをパス指定無しで実行できるようにする
export PATH := BIN_DIR + ":" + env_var("PATH")

default:
    @just --list

[private]
apply:
   chezmoi apply --verbose --interactive

# 変更の詳細を表示
diff:
    chezmoi status
    chezmoi diff

# 更新のDry-run
dry-run:
    chezmoi apply --dry-run --verbose

setup:
    echo "初期セットアップを実行します..."
    echo "実行対象のファイル一覧:"
    echo "- run_once_xxx"
    echo "- run_onchange_xxx"
    echo "- run_xxx"
    just apply

reset:
    echo "以下のファイルをリセットします..."
    just diff
    echo "実行対象のファイル一覧:"
    echo "- run_onchange_xxx"
    echo "- run_xxx"
    echo "⚠️注意: 変更内容は失われます。"
    just apply

update:
    @echo "dotfilesリポジトリを更新します..."
    @deploy.sh

upgrade:
    echo "brewと管理パッケージを更新します..."
    brew update
    brew upgrade

dump:
    @echo "管理パッケージをdumpします..."
    brew bundle dump --force --describe --file "$(SOURCE_DIR)/Brewfile"
